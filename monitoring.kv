#:import date datetime.date
#:import timedelta datetime.timedelta
ScreenManager:
    Screen:
        name: "auth"
        AuthView:
            id: auth_view
            orientation: "vertical"
            BoxLayout:
                TextInput:
                    id: first_name
                    write_tab: False
                    hint_text: "First Name"
                    text: self.parent.parent.session.get('first_name')
                    multiline: False
                TextInput:
                    id: last_name
                    write_tab: False
                    hint_text: "Last Name"
                    text: self.parent.parent.session.get('last_name')
                    multiline: False
            TextInput:
                id: email
                write_tab: False
                hint_text: "Email"
                text: self.parent.session.get('email')
                multiline: False
            TextInput:
                id: private_key
                write_tab: False
                hint_text: "Private Key"
            BoxLayout:
                ToggleButton:
                    id: teacher_button
                    text: "Teacher"
                    group: "account_type"
                    state: "down"
                ToggleButton:
                    id: admin_button
                    text: "Admin"
                    group: "account_type"
                    disabled: True  # ToDo: remove once teacher view exists
            Button:
                text: "Authenticate"
#                disabled: not (first_name.text and last_name.text and email.text and private_key.text)
                on_press: auth_view.check_authenticate()

    Screen:
        name: "teacher"
        TeacherView:
            id: teacher_view

            attendance_list_yesterday: attendance_list_yesterday
            attendance_list: attendance_list
            student_list: student_list
            student_overview: student_overview
            grades_list: grades_list
            fees_list: fees_list
            plan_list: plan_list

            TabbedPanel:
                do_default_tab: False

                TabbedPanelItem:
                    id: panel_item
                    text: f"Today\n[size=13sp]{date.today().strftime('%d-%m-%Y')}[/size]"
                    markup: True

                    Accordion:
                        orientation: "vertical"

                        AccordionItem:
                            title: "Yesterday"

                            ScrollView:
                                do_scroll_x: False

                                BoxLayout:
                                    # Only shows the students for which attendance was not entered yesterday
                                    id: attendance_list_yesterday
                                    orientation: "vertical"
                                    size_hint_y: None
                                    height: len(self.children) * 80
                                    on_children: self.parent.height = sum(c.height for c in self.parent.children)
                                    minimum_height: 10

                        AccordionItem:
                            title: "Today"

                            ScrollView:
                                do_scroll_x: False

                                BoxLayout:
                                    id: attendance_list
                                    orientation: "vertical"
                                    size_hint_y: None
                                    height: len(self.children) * 80
                                    on_children: self.parent.height = sum(c.height for c in self.parent.children)
                                    minimum_height: 10

                TabbedPanelItem:
                    text: "Students"

                    BoxLayout:
                        orientation: "vertical"

                        MDFillRoundFlatIconButton:
                            id: add_student
                            icon: "plus"
                            text: "Add Student"
                            size_hint_x: 1
                            size_hint_y: None
                            height: 80
                            on_press: root.current = "add_child"

                        ScrollView:
                            Accordion:
                                id: student_list
                                orientation: "vertical"
                                size_hint_y: None
                                minimum_height: 100

                TabbedPanelItem:
                    text: f"Grades\n[size=13sp]{(date.today().replace(day=1) - timedelta(days=1)).strftime('%b-%Y')}[/size]"
                    markup: True

                    ScrollView:
                        BoxLayout:
                            id: grades_list
                            orientation: "vertical"
                            size_hint_y: None
                            size_hint_x: None
                            width: 1500
                            on_children: self.height = len(self.children) * 80
                            minimum_height: 100

                TabbedPanelItem:
                    text: f"Fees\n[size=13sp]{(date.today().replace(day=1) - timedelta(days=1)).strftime('%b-%Y')}[/size]"
                    markup: True

                    ScrollView:
                        BoxLayout:
                            id: fees_list
                            orientation: "vertical"
                            size_hint_y: None
                            size_hint_x: None
                            width: 1500
                            on_children: self.height = len(self.children) * 80
                            minimum_height: 100

                TabbedPanelItem:
                    text: "Plan"
                    PlanView:
                        id: plan_list

                TabbedPanelItem:
                    text: "Overview"
                    TabbedPanel:
                        id: student_overview
                        do_default_tab: False

    Screen:
        name: "add_child"
        NewChildView:
            id: new_child_view
            orientation: "vertical"

            name: name
            date_of_joining: date_of_joining
            group: group
            name_father: name_father
            name_mother: name_mother
            address: address
            phone_mother: phone_mother
            phone_father: phone_father
            dob: dob
            aadhar: aadhar
            official_class: official_class
            goes_government_school_yes: goes_government_school_yes
            goes_government_school_no: goes_government_school_no
            occupation_mother: occupation_mother
            occupation_father: occupation_father
            comment: comment

            GridLayout:
                cols: 2
                row_default_height: 80
                size_hint_y: None
                height: self.minimum_height  #len(self.children) * .5 * 30

                Label:
                    text: "Name"

                TextInput:
                    id: name
                    write_tab: False
                    multiline: False

                Label:
                    text: 'Date of joining (YYYY-MM-DD)'

                TextInput:
                    id: date_of_joining
                    write_tab: False
                    multiline: False

                Label:
                    text: "Group"

                TextInput:
                    id: group
                    write_tab: False
                    multiline: False

                Label:
                    text: "Father's name"

                TextInput:
                    id: name_father
                    write_tab: False
                    multiline: False

                Label:
                    text: "Mother's name"

                TextInput:
                    id: name_mother
                    write_tab: False
                    multiline: False

                Label:
                    text: "Address"

                TextInput:
                    id: address
                    write_tab: False
                    multiline: False

                Label:
                    text: "Phone number (Mother)"

                TextInput:
                    id: phone_mother
                    write_tab: False
                    multiline: False

                Label:
                    text: "Phone number (Father)"

                TextInput:
                    id: phone_father
                    write_tab: False
                    multiline: False

                Label:
                    text: "Date of birth (YY-MM-DD)"

                TextInput:
                    id: dob
                    write_tab: False
                    multiline: False

                Label:
                    text: "Aadhar Card number"

                TextInput:
                    id: aadhar
                    write_tab: False
                    multiline: False

                Label:
                    text: "Official Class"

                TextInput:
                    id: official_class
                    write_tab: False
                    multiline: False

                Label:
                    text: "Goes to government school: "

                BoxLayout:
                    ToggleButton:
                        id: goes_government_school_yes
                        text: "Yes"
                        group: "government_school"
                        state: "down"

                    ToggleButton:
                        id: goes_government_school_no
                        text: "No"
                        group: "government_school"

                Label:
                    text: "Mother' main occupation"

                TextInput:
                    id: occupation_mother
                    write_tab: False
                    multiline: False

                Label:
                    text: "Father' main occupation"

                TextInput:
                    id: occupation_father
                    write_tab: False
                    multiline: False

            TextInput:
                id: comment
                write_tab: False
                hint_text: "Comment"

            MDFillRoundFlatIconButton:
                icon: "plus"
                size_hint_y: None
                height: 40
                text: "Add"
                on_press: self.parent.submit()
